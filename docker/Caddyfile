{
    # https://caddyserver.com/docs/caddyfile/options#log
    log {
        level INFO
        output stdout
        format console
    }

    # https://caddyserver.com/docs/caddyfile/options#admin
    admin off
    persist_config off

    # https://caddyserver.com/docs/caddyfile/patterns#caddy-proxying-to-another-caddy
    servers {
        trusted_proxies static private_ranges
    }
}

(server_conf) {
    # Enable PHP processing via FastCGI
    php_fastcgi mcp:9000
    root * /app/public

    # Security headers
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        X-XSS-Protection "1; mode=block"
        Referrer-Policy strict-origin-when-cross-origin
        -Server
    }
}

# HTTPS server with internal certificates
{$HOSTNAME} {
    import server_conf

    tls {
        protocols tls1.3
    }

    # Serve static files
    file_server
}

# HTTP development server (no TLS)
:8343 {
    import server_conf

    # Serve static files
    file_server
}
